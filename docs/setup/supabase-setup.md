# 🔧 Supabase Setup Guide

## 1. Create a Supabase Project

1. Go to [https://supabase.com](https://supabase.com) and sign in or create an account.
2. Click **"New Project"**.
3. Fill in:
   - Project name
   - Database password
   - Preferred region
4. Wait for Supabase to initialize (1–2 minutes).

---

## 2. Get Project Credentials

1. Go to your project dashboard.
2. Open **Project Settings → API**.
3. Copy the following:
   - `Project URL` → use as `NEXT_PUBLIC_SUPABASE_URL`
   - `anon` public key → use as `NEXT_PUBLIC_SUPABASE_ANON_KEY`
4. Add them to your `.env.local` file:

```env
NEXT_PUBLIC_SUPABASE_URL=https://your-project-id.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=your-anon-key
```

## 3. Database Schema

Run the following SQL in Supabase SQL Editor to create the necessary tables:

### 📚 Books Table

```
create table public.books (
id bigint generated by default as identity primary key,
created_at timestamptz default timezone('utc', now()),
name text,
author text,
genre text,
publication_date timestamp
);
```

### 👤 Users Table

```
create table public.users (
  id uuid primary key references auth.users on delete cascade,
  username text,
  email text,
  admin boolean default false,
  created_at timestamptz default timezone('utc', now())
);
```

### 📦 Library Table

```
create table public.library (
  id bigint generated by default as identity primary key,
  book_id bigint references books(id) on delete cascade,
  quantity int
);
```

### 📖 Loans Table

```
create table public.loans (
  id bigint generated by default as identity primary key,
  book_id bigint references books(id) on delete cascade,
  user_id uuid references users(id) on delete cascade,
  quantity int,
  status text,
  start_date timestamptz,
  end_date timestamptz
);
```

---

## 4. Row-Level Security Policies

Enable RLS for each table and create policies for SELECT, INSERT, UPDATE, and DELETE as needed.

### Example policies:

✅ Allow authenticated users to insert into `library`

```
create policy "Allow authenticated insert for library"
  on library
  for insert
  to authenticated
  with check (true);
```

✅ Example: view and update your own loans

```
create policy "Users can view their own loans"
  on loans
  for select
  using (auth.uid() = user_id);

create policy "Users can insert their own loans"
  on loans
  for insert
  to authenticated
  with check (auth.uid() = user_id);

```

Repeat similar policies for books, users, library as needed depending on your app logic (e.g., only admins can edit books, anyone can view library, etc.).

---

## 5. Initial Data: Insert Examples

### Add books

```
insert into books (name, author, genre, publication_date)
values
  ('Harry Potter and the Philosopher''s Stone', 'J.K. Rowling', 'Fantasy', '1997-06-26'),
  ('The Hobbit', 'J.R.R. Tolkien', 'Fantasy', '1937-09-21');
```

### Add stock to library

```
insert into library (book_id, quantity)
values
  (1, 10),
  (2, 5);
```

Adjust book_id values based on your actual data.

---

## 6. Project Validation

To verify your Supabase setup:

- ✅ `.env.local` file exists and includes:

  ```env
  NEXT_PUBLIC_SUPABASE_URL=...
  NEXT_PUBLIC_SUPABASE_ANON_KEY=...
  ```

- ✅ All required tables are created

- ✅ Row-Level Security (RLS) policies are applied correctly

- ✅ Sample data has been inserted

- ✅ Supabase credentials are used correctly in your codebase

- ✅ A validation script already exists at front/verify-supabase.ts

You can run this script to test the connection and basic queries automatically. `verify-supabase.ts`

---

## 7. Troubleshooting

### 🔐 "Invalid API Key"

- Double-check key in .env.local

- Ensure there are no trailing spaces

### ❌ "Table does not exist"

- Confirm that all CREATE TABLE - SQL commands have been executed

### 🔁 "Policy Denied"

- Ensure correct Row-Level
- Security policies are applied
